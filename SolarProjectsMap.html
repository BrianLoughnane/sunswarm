<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <!-- Production version
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdAHn9T3KmYHREyATutN1U1EsdXwYu3FE"> -->
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?sensor=false">
    </script>
    <script src='js/underscore.js'></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
    <script type="text/javascript">
      var customerData = JSON.parse(sessionStorage.getItem('customerData'));

      var geocoder;
      var map;
      var latitude = 37;
      var longitude = -122;
      var sunImage = 'images/sun.png';
      var houseImage = 'house.png';
      function setLatLong(lat, long) {
        latitude = lat;
        longitude = long;
        initialize();
      }
      // Parse.initialize("KMXJi39L5mHkKU0RGNmqX2xvV3N8xfD6xht4ZeyJ", "XWCUCmyNphIpRGK0KcwNuVv2XbC2QVcZvtfpm3SS");

      // function getSolarProjects() {
        
      //   var SolarProject = Parse.Object.extend("SolarProject");
      //   var query = new Parse.Query(SolarProject);

      //   var solarProjects = new Array();
      //   query.find({
      //     success: function(results) {
      //       alert("Successfully retrieved " + results.length + " scores.");
      //       // Do something with the returned Parse.Object values
      //       for (var i = 0; i < results.length; i++) { 
      //         var object = results[i];
      //         var solarProject = {};
      //         solarProject["name"] = object.get('name'); 
      //         solarProject["size"] = object.get('size'); 
      //         solarProject["county"] = object.get('county'); 
      //         solarProject["address"] = object.get('address'); 
      //         solarProject["utility"] = object.get('utility'); 
      //         solarProject["kwh"] = object.get('kwh'); 

      //         solarProjects.push(solarProject);
      //       }
      //     return solarProjects;
      //     },
      //     error: function(error) {
      //       alert("Error: " + error.code + " " + error.message);
      //     }
      //   });
      // }

      function loadAddresses() {   
        for(var customer in customerData) {
          _.delay(codeAddress, 500, customerData[customer].address + ' Oakland, CA', houseImage);          
        }

        var solarProjects = ['149 Montecito Ave', '45500 Fremont Blvd', '426 17th St', '2026 Broadway', '88 Collin P Kelly Jr '];

        _.each(solarProjects, function (project) {
          var address = project + ' Oakland, CA';
          debugger
          _.delay(codeAddress, 300, address, sunImage);
        });
      }


      function initialize() {
        geocoder = new google.maps.Geocoder();
        var latlng = new google.maps.LatLng(latitude, longitude);
        var mapOptions = {
          zoom: 8,
          center: latlng
        }
        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        loadAddresses();
      }

      function codeAddress(address, image) {
        geocoder.geocode( { 'address': address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            map.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location,
                icon: image
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

      google.maps.event.addDomListener(window, 'load', initialize);


      
    </script>
  </head>
  <body>
<div id="map-canvas"></div>
  </body>
</html>